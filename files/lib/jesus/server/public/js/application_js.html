<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>application.js</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../../../../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../../../../../css/main.css" type="text/css" media="screen" />
    <script src="../../../../../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../../../../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            application.js
        </h1>
        <ul class="files">
            <li>lib/jesus/server/public/js/application.js</li>
            <li>Last modified: Wed Dec 16 11:19:23 +0100 2009</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
$(document).ready(function() {
</p>
<pre>
  var timeOut = 30000;

  /*
  * Regularly, we start a new processes lookup
  * Only if we're on a page that needs it (with a &quot;automatic update&quot; div)
  */
  if (document.getElementById('automatic_update') != null) {
    setTimeout(function() {
      update_processes();
    }, timeOut);
  }
</pre>
<p>
})
</p>
<p>
/*
</p>
<ul>
<li>We look the processes statu

</li>
<li>And we update the status if it&#8217;s been changed

</li>
</ul>
<p>
*/ function update_processes() {
</p>
<pre>
  // We get the json data
  $.getJSON('/json', function(data){
    // We loop through the groups
    $.each(data, function(i, group) {
      // And through the processes
      $.each(group, function(j, item) {
        // And we update the process's class with the state
        $('#' + i + '-' + j).attr('class', item.state);
      });
    });

    // And we update the last automatic update date
    var d = new Date();
    $('#automatic_update').html('Statuses update at ' + d.getHours() + ':' + zeroPad(d.getMinutes(), 1));
  });

  /*
  * We want to update the processes regularly. So we add a new timer
  * For now, we can add this timer in this function as we don't use it anywhere else than in the automatic update
  * TODO: remove it from here to allow the add of a manual &quot;update processes&quot; link.
  */
  setTimeout(function() {
    update_processes();
  }, timeOut);
</pre>
<p>
}
</p>
<p>
/*
</p>
<pre>
 * Appends a zero to the appropriate number of zeros to a number so we always have the same number of digits when transforming to a string
 * There's probably a better solution to doing this. I'm highly open to suggestions.
</pre>
<p>
*/ function zeroPad(num, count) {
</p>
<pre>
  var numZeropad = num + '';
  while(numZeropad.length &lt; count) {
    numZeropad = &quot;0&quot; + numZeropad;
  }
  return numZeropad;
</pre>
<p>
}
</p>

    </div>
    

    

    
    

    
    

    

    

    

    

    

    
</div>
    </div>
  </body>
</html>